<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>My Notes</title>

        <!-- 立即应用主题，防止闪烁 -->
        <script>
            (function () {
                try {
                    const savedTheme = localStorage.getItem("theme") || "light";
                    document.documentElement.setAttribute(
                        "data-theme",
                        savedTheme,
                    );
                } catch (e) {
                    document.documentElement.setAttribute(
                        "data-theme",
                        "light",
                    );
                }
            })();
        </script>

        <!-- 外部依赖 -->
        <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-typescript.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markdown.min.js"></script>

        <!-- 本地样式 -->
        <link rel="stylesheet" href="./css/styles.css" />
    </head>
    <body>
        <div class="container">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="header-top">
                        <div class="logo" id="sidebarLogo">My Notes</div>
                        <div class="header-actions">
                            <button
                                class="icon-btn"
                                id="themeToggleBtn"
                                title="主题设置"
                            >
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                </svg>
                            </button>
                            <button
                                class="icon-btn"
                                id="refreshBtn"
                                title="刷新"
                            >
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                >
                                    <path
                                        d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"
                                    />
                                </svg>
                            </button>
                            <button
                                class="icon-btn"
                                id="settingsBtn"
                                title="配置"
                            >
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                >
                                    <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
                                    <path
                                        d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"
                                    />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="search-box">
                        <span class="search-icon">
                            <svg
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                style="width: 14px; height: 14px"
                            >
                                <circle cx="11" cy="11" r="8" />
                                <path d="M21 21l-4.35-4.35" />
                            </svg>
                        </span>
                        <input
                            type="text"
                            class="search-input"
                            id="searchInput"
                            placeholder="搜索笔记..."
                        />
                    </div>
                </div>
                <div class="nav-tree" id="navTree"></div>
            </aside>

            <div class="mobile-overlay" id="mobileOverlay"></div>

            <!-- Main Content -->
            <main class="main-content">
                <div class="loading-bar" id="loadingBar"></div>
                <div class="toolbar">
                    <div class="toolbar-left">
                        <button
                            class="icon-btn mobile-menu-btn"
                            id="mobileMenuBtn"
                            aria-label="切换侧边栏"
                        >
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="9" y1="3" x2="9" y2="21"/>
                            </svg>
                        </button>
                        <div class="toolbar-title" id="toolbarTitle">
                            选择一个笔记
                        </div>
                    </div>
                    <div class="toolbar-actions">
                        <button class="icon-btn" id="githubBtn" title="GitHub">
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 16 16"
                                fill="currentColor"
                            >
                                <path
                                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
                                ></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="content-viewport" id="contentViewport">
                    <div class="content-area" id="contentArea">
                        <div class="empty-state">
                            <div
                                class="logo"
                                style="
                                    font-size: 24px;
                                    margin-bottom: 16px;
                                    opacity: 0.5;
                                "
                            >
                                NOTES
                            </div>
                            <p>从左侧目录选择一个 Markdown 文件开始阅读</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Settings Modal -->
        <div class="modal-overlay" id="settingsModal">
            <div class="modal settings-modal">
                <div class="settings-header">
                    <h3 class="settings-title">仓库配置</h3>
                    <button class="settings-close" id="settingsCloseBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>

                <div class="settings-body">
                    <!-- 快速导入卡片 -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            <h4>快速导入</h4>
                        </div>
                        <div class="quick-import-row">
                            <input
                                type="text"
                                class="form-input"
                                id="importUrlInput"
                                placeholder="粘贴 GitHub 仓库链接"
                            />
                            <button class="btn primary" id="importUrlBtn">导入</button>
                        </div>
                    </div>

                    <!-- 仓库信息卡片 -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                            </svg>
                            <h4>仓库信息</h4>
                        </div>
                        <div class="form-row-two">
                            <div class="form-group">
                                <label class="form-label">所有者</label>
                                <input type="text" class="form-input" id="githubUsername" placeholder="用户名或组织" />
                            </div>
                            <div class="form-group">
                                <label class="form-label">仓库名</label>
                                <input type="text" class="form-input" id="githubRepo" placeholder="my-notes" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">根目录（可选）</label>
                            <input type="text" class="form-input" id="githubPath" placeholder="例如: docs 或 notes" />
                        </div>
                    </div>

                    <!-- 访问权限卡片 -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0110 0v4"/>
                            </svg>
                            <h4>访问权限</h4>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                GitHub Token
                                <span class="form-label-hint">私有仓库必填</span>
                            </label>
                            <div class="password-input-wrapper">
                                <input type="password" class="form-input" id="githubToken" placeholder="ghp_xxxxxxxxxxxx" />
                                <button class="password-toggle" type="button" id="tokenToggleBtn">
                                    <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                        <circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                        <path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/>
                                        <line x1="1" y1="1" x2="23" y2="23"/>
                                    </svg>
                                </button>
                            </div>
                            <p class="form-hint">
                                Token 仅保存在本地浏览器中，用于访问私有仓库
                                <a href="https://github.com/settings/tokens/new" target="_blank">如何获取？</a>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="settings-footer">
                    <button class="btn" id="settingsCancel">取消</button>
                    <button class="btn primary" id="settingsSave">保存配置</button>
                </div>
            </div>
        </div>

        <div class="toast" id="toast"></div>

        <!-- 主题面板遮罩层 -->
        <div class="theme-panel-overlay" id="themePanelOverlay"></div>

        <!-- 主题面板 -->
        <div class="theme-panel" id="themePanel">
            <div class="theme-panel-header">
                <span>主题设置</span>
                <button class="theme-close-btn" id="themeCloseBtn">×</button>
            </div>

            <div class="theme-section">
                <div class="theme-section-title">模式</div>
                <div class="theme-mode-toggles">
                    <button class="theme-mode-btn" data-mode="light">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"/>
                            <line x1="12" y1="1" x2="12" y2="3"/>
                            <line x1="12" y1="21" x2="12" y2="23"/>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                            <line x1="1" y1="12" x2="3" y2="12"/>
                            <line x1="21" y1="12" x2="23" y2="12"/>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                        </svg>
                        <span>亮色</span>
                    </button>
                    <button class="theme-mode-btn" data-mode="dark">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
                        </svg>
                        <span>暗色</span>
                    </button>
                </div>
            </div>

            <div class="theme-section">
                <div class="theme-section-title">颜色</div>
                <div class="theme-color-grid">
                    <button class="theme-color-btn" data-color="blue" style="--preview: #002fa7" title="蓝色">
                        <span class="color-name">蓝</span>
                    </button>
                    <button class="theme-color-btn" data-color="green" style="--preview: #059669" title="绿色">
                        <span class="color-name">绿</span>
                    </button>
                    <button class="theme-color-btn" data-color="purple" style="--preview: #7c3aed" title="紫色">
                        <span class="color-name">紫</span>
                    </button>
                    <button class="theme-color-btn" data-color="orange" style="--preview: #ea580c" title="橙色">
                        <span class="color-name">橙</span>
                    </button>
                    <button class="theme-color-btn" data-color="red" style="--preview: #dc2626" title="红色">
                        <span class="color-name">红</span>
                    </button>
                    <button class="theme-color-btn" data-color="pink" style="--preview: #db2777" title="粉色">
                        <span class="color-name">粉</span>
                    </button>
                    <button class="theme-color-btn" data-color="rose" style="--preview: #e11d48" title="玫红">
                        <span class="color-name">玫</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 浮动操作按钮 -->
        <div class="fab-container">
            <button class="fab-main" aria-label="功能菜单">
                <svg class="fab-icon-close" style="display:none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
                <svg class="fab-icon-menu" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
            </button>
            <div class="fab-menu">
                <button class="fab-item" data-action="copy-md">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                    </svg>
                    <span class="fab-tooltip">复制 Markdown</span>
                </button>
                <button class="fab-item" data-action="scroll-top">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"/>
                    </svg>
                    <span class="fab-tooltip">回到顶部</span>
                </button>
                <button class="fab-item" data-action="scroll-bottom">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                    <span class="fab-tooltip">跳到底部</span>
                </button>
            </div>
        </div>

        <!-- 应用入口 -->
        <script type="module" src="./js/main.js"></script>
    </body>
</html>
