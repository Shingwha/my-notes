# My-Notes 重构设计文档

## 项目概述

这是一个基于 GitHub API 的静态笔记浏览应用，部署在 GitHub Pages 上。应用通过读取指定 GitHub 仓库的 Markdown 文件，提供树形导航和内容展示功能。

---

## 一、当前架构分析

### 1.1 技术栈
- **前端框架**: 原生 HTML/CSS/JavaScript (零依赖，除 marked.js)
- **外部依赖**: `marked@11.1.1` (Markdown 解析)
- **数据源**: GitHub REST API v3
- **存储**: localStorage (配置持久化)
- **部署**: GitHub Pages

### 1.2 核心类设计

```
ConfigManager (配置管理)
├── constructor()           // 初始化并尝试自动检测配置
├── loadConfig()            // 从 localStorage 读取配置
├── saveConfig(config)      // 保存配置到 localStorage
├── isValid()               // 验证配置有效性
├── autoDetectFromUrl()     // 从 URL 自动检测配置
├── getApiUrl(subPath)      // 生成 GitHub API URL
└── getRepoUrl()            // 生成 GitHub 仓库 URL

DataManager (数据管理)
├── constructor(config)     // 接收 ConfigManager 实例
├── fetchPath(path)         // 获取路径内容（带缓存）
├── processData(data)       // 处理 API 返回数据
└── getRaw(url)             // 获取原始文件内容

UIManager (界面管理)
├── constructor(config, data)  // 接收 ConfigManager 和 DataManager
├── init()                     // 初始化和事件绑定
├── bindEvents()               // 绑定所有事件监听器
├── showToast(msg)             // 显示提示消息
├── showSettings()             // 显示设置模态框
├── hideModal(id)              // 隐藏模态框
├── saveSettings()             // 保存设置并刷新
├── refreshData()              // 刷新数据并渲染树
├── renderTree(container, items)  // 递归渲染导航树
└── loadFile(item)             // 加载并显示文件内容
```

### 1.3 数据流

```
用户操作 → UIManager 事件处理 → DataManager 获取数据 → GitHub API
     ↑                                                      ↓
     └───── ConfigManager (配置) ←───── localStorage/URL 参数
```

---

## 二、当前设计的优点

### 2.1 架构优势
1. **零依赖部署**: 仅需一个 HTML 文件，无需构建工具
2. **自动配置**: 支持从 URL 参数或 GitHub Pages URL 自动检测配置
3. **响应式设计**: 完整的移动端适配（≤1024px, ≤768px, ≤480px）
4. **性能优化**: 
   - API 响应缓存 (Map)
   - requestAnimationFrame 优化渲染
   - 异步懒加载子目录
5. **用户体验**: 
   - 触摸设备优化
   - 键盘导航 (ESC 关闭)
   - 加载状态反馈
   - 移动端菜单自动关闭

### 2.2 代码质量
- **模块化**: 清晰的类职责分离
- **错误处理**: 完整的 try-catch 和用户反馈
- **可访问性**: 清晰的视觉层次和交互反馈

---


### 3.2 功能增强建议

#### 3.2.1 核心功能
- **搜索功能**: 在当前仓库中搜索关键词


#### 3.2.2 增强功能
- **Markdown 增强**: 
  - 代码高亮（集成 Prism.js 或 Highlight.js）
  - TOC 自动生成
  - Mermaid 图表支持
- **文件操作**: 
  - 下载 Markdown 源文件
  - 复制链接
  - 在 GitHub 中查看
- **多视图**: 
  - 预览模式
  - 编辑模式（需要 GitHub Token）
  - 分屏模式

#### 3.2.3 性能优化
- **虚拟滚动**: 大型目录树优化
- **Web Workers**: Markdown 解析后台处理
- **Service Worker**: 离线缓存和 PWA 支持
- **图片懒加载**: 延迟加载 Markdown 中的图片

### 3.3 代码组织重构

#### 3.3.1 文件拆分（保持单文件优势）
如果需要保持单文件，可以使用以下结构：

```html
<script>
// === 配置管理模块 ===
const ConfigModule = { /* ... */ };

// === 数据管理模块 ===
const DataModule = { /* ... */ };

// === UI 组件模块 ===
const UIModule = { /* ... */ };

// === 路由模块 ===
const RouterModule = { /* ... */ };

// === 主应用 ===
const App = {
    init() { /* ... */ }
};
</script>
```



### 3.4 移动端进一步优化

#### 3.4.1 PWA 支持
```html
<!-- 添加 Manifest 和 Service Worker -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0a0a">
```

#### 3.4.2 触摸手势
- 左右滑动切换菜单
- 下拉刷新
- 长按显示上下文菜单

---

## 四、优先级建议

### Phase 1: 核心优化（立即实施）
1. ✅ **路由系统**: 支持 URL hash 导航（分享链接）
2. ✅ **搜索功能**: 简单的文本搜索
3. ✅ **代码高亮**: 提升代码块可读性

### Phase 2: 用户体验（短期）
1. **主题切换**: 浅色/深色模式
