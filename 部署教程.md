# My Notes 部署与配置指南

本指南将手把手教你从零开始部署 **My Notes** 笔记浏览器，并将其连接到你的 GitHub 笔记仓库。

---

## 目录

1. [准备工作](#1-准备工作)
2. [获取项目代码](#2-获取项目代码)
3. [本地预览与个性化](#3-本地预览与个性化)
4. [推送到 GitHub](#4-推送到-github)
5. [启用 GitHub Pages](#5-启用-github-pages)
6. [连接笔记仓库](#6-连接笔记仓库)
7. [常见问题](#7-常见问题)

---

## 1. 准备工作

### 1.1 账号准备

- 确保你已注册 [GitHub](https://github.com) 账号
- 如需访问私有笔记仓库，准备好访问权限

### 1.2 工具准备

#### 检查是否已安装 Git

打开终端（Windows 按 `Win + R` 输入 `cmd` 或使用 Git Bash），运行：

```bash
git --version
```

**如果显示版本号**（如 `git version 2.xx.x`）：说明已安装，跳过此步骤。

**如果提示命令不存在**：请下载安装 [Git](https://git-scm.com/downloads)。

---

## 2. 获取项目代码

### 两种方式对比

| 方式 | 适合人群 | 优点 | 缺点 |
|------|----------|------|------|
| **Fork** | 想快速开始、不需要修改源码 | 简单快捷，保留与原仓库的关联 | 仓库结构受原项目限制 |
| **Clone + 新建仓库** | 想完全自定义项目 | 自由度最高，可以随意修改 | 步骤稍多 |

---

### 方式 A：Fork（推荐，快速开始）

#### 步骤 1：Fork 原仓库

1. 访问 [shingwha/my-notes](https://github.com/shingwha/my-notes)
2. 点击右上角 **Fork** 按钮
3. 等待几秒，GitHub 会自动创建一个属于你的副本仓库

#### 步骤 2：Clone 到本地

1. 进入你 Fork 后的仓库页面（地址为 `https://github.com/<你的用户名>/my-notes`）
2. 点击绿色 **Code** 按钮，复制 HTTPS 链接
3. 在终端中运行：

```bash
# 切换到你想要的目录
cd Desktop

# Clone 仓库（替换成你自己的链接）
git clone https://github.com/<你的用户名>/my-notes.git

# 进入项目目录
cd my-notes
```

**方式 A 完成！** 继续阅读 [第 3 步](#3-本地预览与个性化)。

---

### 方式 B：Clone + 新建仓库（完全自定义）

#### 步骤 1：Clone 原仓库

```bash
# Clone 原仓库
git clone https://github.com/shingwha/my-notes.git

# 进入项目目录
cd my-notes
```

#### 步骤 2：在 GitHub 创建新仓库

1. 访问 GitHub，点击右上角 **+** → **New repository**
2. 填写仓库名（如 `my-notes` 或 `notes-browser`）
3. 设置为 **Public**（GitHub Pages 免费版仅支持公开仓库）
4. **不要**勾选 "Add a README file"
5. 点击 **Create repository**

#### 步骤 3：修改 Git 远程地址

```bash
# 删除原有的远程地址
git remote remove origin

# 添加你自己的仓库地址（替换成你的链接）
git remote add origin https://github.com/<你的用户名>/my-notes.git

# 查看远程地址（确认修改成功）
git remote -v
```

**方式 B 完成！** 继续阅读 [第 3 步](#3-本地预览与个性化)。

---

## 3. 本地预览与个性化

### 3.1 启动本地服务器

#### Windows 用户（推荐）

双击项目根目录下的 **`start.bat`** 文件，浏览器会自动打开 `http://localhost:8080`。

#### 手动启动

如果你已安装 Python 或 Node.js，也可以手动运行：

**Python**：
```bash
python -m http.server 8080
```

**Node.js**：
```bash
npx http-server -p 8080
```

然后访问 `http://localhost:8080`。

**停止服务器**：在终端按 `Ctrl + C`。

---

### 3.2 个性化配置

你可以根据需要修改以下内容：

#### 修改网站标题

编辑 `index.html` 文件，找到第 6 行：

```html
<title>My Notes</title>
```

将 `My Notes` 改成你想要的标题，如 "我的知识库"、"技术笔记" 等。

#### 修改侧边栏 Logo

编辑 `index.html`，找到第 53 行：

```html
<div class="logo" id="sidebarLogo">My Notes</div>
```

修改文字内容即可。

#### 修改默认主题

编辑 `index.html`，找到第 12 行：

```javascript
const savedTheme = localStorage.getItem("theme") || "light";
```

将 `"light"` 改为以下任一主题：
- `"dark"` - 暗色蓝色（默认）
- `"dark-purple"` - 暗色紫色
- `"dark-green"` - 暗色绿色
- `"dark-orange"` - 暗色橙色
- `"dark-red"` - 暗色红色
- `"dark-pink"` - 暗色粉色
- `"dark-rose"` - 暗色玫红色

---

## 4. 推送到 GitHub

### 方式 A：使用 Git 命令行

#### 4.1 查看修改状态

```bash
git status
```

这会显示你修改了哪些文件。

#### 4.2 添加修改到暂存区

```bash
# 添加所有修改的文件
git add .

# 或者只添加特定文件
git add index.html
```

#### 4.3 提交修改

```bash
git commit -m "个性化配置"
```

#### 4.4 推送到 GitHub

```bash
# 推送到主分支
git push -u origin main

# 如果是旧版 Git，主分支可能叫 master
git push -u origin master
```

#### 认证问题

如果提示需要登录，请使用 **GitHub Personal Access Token**：

1. 访问 https://github.com/settings/tokens
2. 点击 **Generate new token (classic)**
3. 勾选 `repo` 权限
4. 生成并复制 Token
5. 在推送时：
   - **用户名**：输入你的 GitHub 用户名
   - **密码**：粘贴刚才生成的 Token（**不是**你的 GitHub 密码）

---

### 方式 B：使用 VS Code（推荐）

如果你不熟悉命令行，VS Code 内置了友好的 Git 图形界面。

#### 步骤：

1. 用 VS Code 打开 `my-notes` 文件夹
2. 修改文件后，点击左侧 **源代码管理** 图标（或按 `Ctrl + Shift + G`）
3. 在"更改"列表中会显示修改的文件，将鼠标悬停在文件上点击 **+** 号暂存
   - 或直接在"消息"框输入提交信息，点击 **✓ 提交**（会暂存所有更改）
4. 在底部状态栏点击 **同步更改** 按钮（ↄ 图标）
   - 或点击状态栏显示的分支名，选择 **推送**

#### 认证问题

VS Code 推送时如果弹出 GitHub 登录窗口：
- 点击 **Sign in** 浏览器授权（推荐）
- 或输入 Personal Access Token（获取方式见上方 [方式 A](#认证问题)）

---

## 5. 启用 GitHub Pages

### 5.1 打开 Pages 设置

1. 访问你推送后的仓库页面（如 `https://github.com/<你的用户名>/my-notes`）
2. 点击顶部 **Settings** 标签
3. 在左侧菜单中找到 **Pages**（在 "Code and automation" 分组下）

### 5.2 配置部署来源

在 **Build and deployment** 部分：

| 设置项 | 选择值 |
|--------|--------|
| **Source** | `Deploy from a branch` |
| **Branch** | `main`（或 `master`）|
| **Folder** | `/ (root)` |

点击 **Save** 保存。

### 5.3 等待部署完成

- 页面顶部会显示 "Your site is live at ..."
- 通常需要 **1-5 分钟**，请耐心等待
- 刷新页面查看最新状态

### 5.4 访问你的网站

部署成功后，访问地址为：

```
https://<你的用户名>.github.io/<仓库名>/
```

例如：`https://shingwha.github.io/my-notes/`

---

## 6. 连接笔记仓库

现在你的网站已经部署成功，接下来需要连接到存放 Markdown 笔记的 GitHub 仓库。

### 6.1 公有仓库（无需 Token）

#### 方式 A：快速导入（推荐）

1. 打开你部署好的网站
2. 点击右上角的 **⚙ (配置)** 图标
3. 在 **快速导入** 卡片中：
   - 粘贴笔记仓库链接（如 `https://github.com/username/notes`）
   - 点击 **导入** 按钮
4. 系统自动识别并填充信息
5. 点击 **保存配置**

#### 方式 B：手动填写

1. 打开网站，进入 **⚙ (配置)**
2. 在 **仓库信息** 卡片中填写：
   - **所有者**：笔记仓库的用户名
   - **仓库名**：笔记仓库名称
   - **根目录（可选）**：如果笔记在某个文件夹下（如 `docs`），填写文件夹名
3. 点击 **保存配置**

#### 方式 C：通过 URL 直接访问

```
https://<你的网站地址>/?user=笔记用户名&repo=笔记仓库名&path=文件夹
```

---

### 6.2 私有仓库（需要 Token）

#### 第一步：生成 GitHub Token

1. 访问 GitHub [Fine-grained tokens](https://github.com/settings/tokens?type=beta)（推荐）
2. 点击 **Generate new token**
3. 设置 Token 名称（如 "My Notes"）和有效期
4. **Repository access**：选择 **Only select repositories** 并选中你的笔记仓库
5. **Permissions**：
   - 找到 **Contents**，选择 **Access: Read-only**
   - **Metadata** 会自动设为只读
6. 点击 **Generate token**
7. **复制生成的 Token**（只显示一次，请妥善保存）

#### 第二步：在 My Notes 中配置

1. 打开网站，进入 **⚙ (配置)**
2. 填写**仓库信息**（用户名、仓库名、根目录）
3. 在 **访问权限** 卡片的 **GitHub Token** 框中粘贴 Token
4. 点击 **保存配置**

> **安全提示**：Token 仅保存在你浏览器的本地存储中，按仓库分别存储，不会上传到任何服务器。但在公共电脑上使用后请记得清理浏览器缓存。

---

## 7. 常见问题

### 7.1 部署相关

**Q: 推送时提示 "Permission denied" 或 "Authentication failed"**

A: GitHub 已不再支持密码认证，请使用 Personal Access Token：
1. 访问 https://github.com/settings/tokens
2. 生成新 Token（勾选 `repo` 权限）
3. 推送时用 Token 代替密码

---

**Q: GitHub Pages 显示 404 错误**

A: 请检查：
1. 是否已成功推送代码到 GitHub
2. Pages 设置中的 Branch 是否正确（应为 `main` 或 `master`）
3. 文件是否在仓库根目录（不在子文件夹中）
4. 等待 5-10 分钟后再刷新

---

**Q: 修改代码后网页没有更新**

A: 可能的原因：
1. **GitHub Pages 正在部署**：等待 1-5 分钟
2. **浏览器缓存**：按 `Ctrl + Shift + R` 强制刷新
3. **未推送修改**：检查 `git push` 是否成功

---

### 7.2 功能相关

**Q: 笔记内容加载失败**

A: 请检查：
- 网络连接是否正常（是否能访问 `api.github.com`）
- 用户名和仓库名是否填写正确
- 私有仓库的 Token 权限是否正确设置（需要 Contents 读权限）

---

**Q: 遇到 API 速率限制**

A: GitHub 对未认证请求有严格限制（每小时 60 次）。建议：
- 为公有仓库也配置一个 Token（只读权限即可）
- 私有仓库必须使用 Token

---

**Q: 本地打开 `index.html` 无法使用**

A: 由于浏览器安全策略（CORS），应用需要通过 HTTP 服务器运行。请使用 [第 3.1 节](#31-启动本地服务器) 的方法启动本地服务器。

---

**Q: 如何切换不同的笔记仓库？**

A: 有以下方式：
- 使用快速导入功能粘贴新仓库链接
- 直接访问 Hash 路由：`#/<用户名>/<仓库名>/<可选路径>`
- 系统会自动加载对应仓库保存的 Token

---

**Q: Token 存在哪里？如何清除？**

A: Token 按仓库存储在浏览器的 `localStorage.blog_tokens_v1` 中。如需清除：
1. 按 `F12` 打开开发者工具
2. 切换到 **Application** 标签
3. 左侧找到 **Local Storage** → 选择你的网站
4. 找到 `blog_tokens_v1` 条目并删除

---

## 附录

### 项目结构

```
my-notes/
├── index.html      # 主入口文件
├── css/
│   └── styles.css  # 样式文件
├── js/
│   ├── main.js     # 入口模块
│   ├── config.js   # 配置管理
│   ├── data.js     # 数据获取
│   ├── ui.js       # 界面渲染
│   └── cache.js    # 图片缓存
├── start.bat       # Windows 本地调试脚本
├── README.md       # 项目说明
└── 部署教程.md     # 本文档
```

### 外部依赖（CDN 自动加载）

| 库 | 版本 | 用途 |
|---|------|------|
| marked | 11.1.1 | Markdown 解析 |
| katex | 0.16.9 | 数学公式渲染 |
| prismjs | 1.29.0 | 代码高亮 |

### 高级功能

- **14 种主题**：亮色/暗色 × 7 种颜色
- **Hash 路由**：`#/<用户>/<仓库>/<路径>` 格式分享链接
- **图片缓存**：IndexedDB 自动缓存 7 天
- **快捷键**：`Ctrl + F` 聚焦搜索框
- **数学公式**：支持 `$$...$$` 和 `$...$` 语法
- **代码高亮**：支持 Bash、JavaScript、TypeScript、Python、Markdown

---

**部署完成后，你就有了一个漂亮的笔记浏览网站！**

如有问题，欢迎在 [GitHub Issues](https://github.com/shingwha/my-notes/issues) 提问。
