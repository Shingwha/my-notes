# My Notes 部署与配置指南

本指南将介绍如何部署 **My Notes** 笔记浏览器，并将其连接到您的 GitHub 公有或私有笔记仓库。

---

## 快速开始

My Notes 是一个纯静态网页应用，无需构建工具或后端服务器，只需几分钟即可部署到 GitHub Pages。

**项目结构**：
```
my-notes/
├── index.html      # 主入口文件
├── css/
│   └── styles.css  # 样式文件
├── js/
│   ├── main.js     # 入口模块
│   ├── config.js   # 配置管理
│   ├── data.js     # 数据获取
│   ├── ui.js       # 界面渲染
│   └── cache.js    # 图片缓存
└── start.bat       # 本地调试启动脚本
```

**外部依赖**（通过 CDN 自动加载）：
- marked@11.1.1 - Markdown 解析
- katex@0.16.9 - 数学公式渲染
- prismjs@1.29.0 - 代码高亮

---

## 1. 部署到 GitHub Pages

### 第一步：创建仓库

在 GitHub 上创建一个新仓库（例如名为 `my-notes`）

### 第二步：上传文件

将以下文件/文件夹上传到仓库根目录：
- `index.html`
- `css/` 文件夹
- `js/` 文件夹

### 第三步：启用 GitHub Pages

1. 进入仓库的 **Settings** → **Pages**
2. 在 **Build and deployment** 下选择：
   - Source: `Deploy from a branch`
   - Branch: `main` (或 `master`)
   - Folder: `/ (root)`
3. 点击 **Save**

### 第四步：访问您的网站

几分钟后，GitHub 会提供访问链接：

```
https://<您的用户名>.github.io/<仓库名>/
```

---

## 2. 连接笔记仓库

### 公有仓库配置

如果您的笔记保存在一个**公开**的 GitHub 仓库中，配置非常简单。

#### 方式 A：快速导入（推荐）

1. 打开部署好的网页
2. 点击右上角的 **⚙ (配置)** 图标
3. 在 **快速导入** 卡片中：
   - 直接粘贴 GitHub 仓库链接（如 `https://github.com/username/notes`）
   - 点击 **导入** 按钮
4. 系统会自动识别并填充用户名和仓库名
5. 点击 **保存配置**

#### 方式 B：手动填写

1. 打开部署好的网页
2. 点击右上角的 **⚙ (配置)** 图标
3. 在 **仓库信息** 卡片中填写：
   - **所有者**：例如 `ShingWha`
   - **仓库名**：例如 `notes-content`
   - **根目录路径** (可选)：如果笔记在某个文件夹下（如 `docs`），请填写
4. 点击 **保存配置**

#### 方式 C：通过 URL 参数直接访问

您可以通过 URL 参数直接访问特定笔记仓库：

```
https://<您的网站地址>/?user=用户名&repo=仓库名&path=文件夹
```

---

### 私有仓库配置

如果您的笔记保存在**私有**仓库中，需要生成 GitHub Personal Access Token (PAT) 来授权访问。

#### 第一步：生成 GitHub Token

1. 访问 GitHub [Fine-grained personal access tokens](https://github.com/settings/tokens?type=beta) (推荐)
2. 点击 **Generate new token**
3. 设置 Token 名称和有效期
4. **Repository access**: 选择 **Only select repositories** 并选中您的笔记仓库
5. **Permissions**:
   - 在 **Repository permissions** 中，找到 **Contents**，选择 **Access: Read-only**
   - **Metadata** 会被自动设为只读
6. 生成并**复制**该 Token（它只会显示一次）

#### 第二步：在 My Notes 中配置

1. 打开网页，进入 **⚙ (配置)**
2. 在 **仓库信息** 中填写用户名和仓库名
3. 在 **访问权限** 卡片的 **GitHub Token** 框中粘贴刚才生成的 Token
4. 点击 **保存配置**

> **安全提示**：Token 仅保存在您浏览器的 `localStorage` 中，按仓库分别存储，不会上传到任何服务器。但在公共电脑上使用时请注意清理缓存。

---

## 3. 进阶功能

### 自动识别仓库

应用支持多种 URL 格式自动识别，优先级从高到低：

1. **URL 参数**：`?user=xxx&repo=xxx&path=xxx`
2. **Hash 路由**：`#/user/repo/path`
3. **GitHub Pages 域名**：`username.github.io/repo` 自动解析
4. **GitHub 标准链接**：支持粘贴 `https://github.com/user/repo` 格式链接

如果您将 `index.html` 部署在笔记仓库本身的 `gh-pages` 分支上，应用会自动识别当前用户名和仓库名，实现"零配置"开箱即用。

### 链接分享

利用 Hash 路由快速分享特定笔记：

**格式**：`#/{用户名}/{仓库名}/{可选路径}`

**示例**：
- 访问仓库根目录：`https://shingwha.github.io/my-notes/#/ShingWha/my-notes`
- 访问特定文件夹：`https://shingwha.github.io/my-notes/#/ShingWha/my-notes/example_notes`

### 主题切换

支持 **14 种主题配色**（2 模式 × 7 颜色）：

- **模式**：亮色 / 暗色
- **颜色**：蓝、绿、紫、橙、红、粉、玫红

点击侧边栏顶部的调色板图标即可打开主题面板进行切换。主题设置会保存在本地，下次访问时自动应用。

### 搜索快捷键

- 按下 `Ctrl + F` (或 `Cmd + F`) 可快速聚焦搜索框
- 搜索支持模糊匹配文件名

### 数学公式与代码高亮

- 使用 **KaTeX** 渲染数学公式（支持 `$$...$$` 和 `$...$` 语法）
- 使用 **Prism.js** 高亮代码（支持 Bash、JavaScript、TypeScript、Python、Markdown）

### 图片缓存

应用使用 IndexedDB 自动缓存图片，有效期 7 天，提升加载速度并减少 API 请求。

---

## 4. 本地调试（开发者）

在部署到 GitHub Pages 之前，您可以在本地进行调试和预览。

### 使用 start.bat（推荐）

**使用步骤**：
1. 双击运行 `start.bat`
2. 浏览器会自动打开 `http://localhost:8080`
3. 按 `Ctrl + C` 停止服务器

**环境要求**：
- Python 3.x 或 Node.js（已安装且在 PATH 中）

### 手动启动服务器

如果您已安装 Python 或 Node.js，也可以手动运行：

**Python**：
```bash
python -m http.server 8080
```

**Node.js**：
```bash
npx http-server -p 8080
```

然后访问 `http://localhost:8080`

### 使用 VS Code

安装 **Live Server** 扩展后：
1. 右键点击 `index.html`
2. 选择 "Open with Live Server"

---

## 常见问题

**Q: 内容加载失败怎么办？**

A: 请检查：
- 网络连接是否正常（是否能访问 api.github.com）
- Token 权限是否正确设置（私有仓库）
- 用户名和仓库名是否填写正确

**Q: API 速率限制怎么办？**

A: GitHub 对匿名请求有严格的速率限制。如果频繁刷新，建议配置 Token 以增加配额（即使是公有仓库）。

**Q: 为什么本地打开 `index.html` 无法使用？**

A: 由于浏览器安全策略（CORS），应用需要通过 HTTP 服务器运行。请使用 `start.bat` 或手动启动本地服务器。

**Q: 如何切换不同的笔记仓库？**

A: 使用快速导入功能粘贴新的仓库链接，或通过 Hash 路由直接访问不同仓库。系统会自动加载对应仓库保存的 Token。

**Q: Token 如何管理？**

A: Token 按仓库分别存储在 `localStorage.blog_tokens_v1` 中。切换仓库时，系统会自动加载该仓库对应的 Token。如需清除，可在浏览器开发者工具的 Application → Local Storage 中删除。
